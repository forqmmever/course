## 1. 引言

这个项目是一个基于Spring Boot和Vue.js的前后端分离的Web应用程序。旨在提供一个云主机告警数据处理模块，用于接收主机各种信息并进行告警。

 

## 2. 模型设计

#### 2.1 记录（Log）模型

属性： 指标(metric),（主机名，主机地址）（tags tagJson） 时间戳(timestamp)，描述（description）,创建时间（time）。

 

Log模型是后端传递数据的主要类型。大部分从数据库存取的数据都使用Log。最初设计通过PostLog WarningLog继承Log以区别告警数据和提交数据，但是因为两个类区别不大，在很多地方设计类型转换，最终将两个子类功能合并到父类中。

需要注意的一点是，Log类型在接收post得到的数据时使用Map<String,String> tags接收

，在与数据库交互则使用的是String tagJson（将tags通过Jackson转化为String）。这是因为tags中的instanceId和hostname关系较为紧密，同时将两者分别与数据库交互实现复杂，增加冗余。所以在数据库使用varchar类型存储，在模型中使用String存储。同时为了避免以上做法导致两者数据不同，修改tags 和tagJson的getter setter方法保证两者数据的统一性。

#### 2.2 指标约束（MetricConstraint）模型

属性：指标（metric），约束类型（constraintType），约束值（value），告警描述（description）。



指标约束模型服务于实时计算和定时，在数据库中对应同名数据表，并使用该模型与表交互。进行规则检查时，通过该模型约束类型和约束值进行计算，如果不符合规则记录告警记录时，将告警描述添加到告警记录中。

特别的在定时任务计算主机网卡入口流量时rate计算中时间范围不易表示为一个属性也不易记录在表中，将其作为定时任务实现类中一个私有变量进行使用，查询和变更。



#### 2.3 其他模型

此外为了接收前端数据。创建了Taskset模型 为了对内存指标进行定时计算创建了MemoryLog模型和像前端返回消息的Result模型

## 3. 服务设计

#### 3.1 指标存储服务

负责接收指标并存入数据库中

提供接收post提交的指标与数据库交互，检查指标并进行错误告警并将告警存入数据库中功能，

#### 3.2 定时计算服务

负责对特定指标进行计算并保存告警信息。

提供定时任务的开启，可更改的开始时间，任务时间间隔，任务启动与暂停。

#### 3.3 聚合计算服务

对相同类型指标进行聚合计算。

提供max、min、sum、avg、rate的聚合操作可添加的告警计算。


## 4 前端vue设计

本次前端设计是基于[GitHub](https://github.com/PanJiaChen/vue-admin-template)的一个纯前端开源项目为基础重构完成，具体包括创建新页面，修改组件先，重写路由设置，修改环境配置，添加api与后端交互，删除无用功能如用户登录，mock拦截。



在前端实现了页面显示告警信息，告警规则。提供对告警规则的新增，删除，修改功能。提供对定时任务开始时间，时间间隔修改功能。

 