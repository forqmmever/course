## 1. 引言

这个项目是一个基于Spring Boot和Vue.js的前后端分离的Web应用程序。旨在提供一个云主机告警数据处理模块，用于接收主机各种信息并进行告警。



## 2. 模型设计

#### 2.1 记录（Log）模型

属性： 指标(metric),（主机名，主机地址）（tags tagJson） 时间戳(timestamp)，描述（description）,创建时间（time）。

Log模型是后端传递数据的主要类型。大部分从数据库存取的数据都使用Log。最初设计通过PostLog WarningLog继承Log以区别告警数据和提交数据，但是因为两个类区别不大，在很多地方设计类型转换，最终将两个子类功能合并到父类中。

需要注意的一点是，Log类型在接收post得到的数据时使用Map<String,String> tags接收，在与数据库交互则使用的是String tagJson（将tags通过Jackson转化为String）。这是因为tags中的instanceId和hostname关系较为紧密，同时将两者分别与数据库交互实现复杂，增加冗余。所以在数据库使用varchar类型存储，在模型中使用String存储。同时为了避免以上做法导致两者数据不同，修改tags 和tagJson的getter setter方法保证两者数据的统一性。

#### 2.2 指标约束（MetricConstraint）模型

属性：指标（metric），约束类型（constraintType），约束值（value），告警描述（description），执行类型（type）。

指标约束模型服务于实时计算和定时计算，在数据库中对应同名数据表。并使用该模型与表交互。执行类型主要指

#### 2.3 其他模型

此外还有接收前端设置定时任务信息的Taskset模型 ，为了对内存指标进行聚合运算所需的aggregation模型，向前端返回消息的Result模型，定义返回code信息的Code模型。



## 3. 服务设计

#### 3.1 指标存储和提取服务

负责接收指标并存入数据库中和将指标从数据库中提取并存入Redis缓存中

提供接收post提交的指标，按需从数据库提取数据并存入缓存

#### 3.2 告警信息存储和提取服务

负责对发现的告警信息存储到数据库和将告警信息提取到Redis缓存中

提供接收产生的告警信息，将告警信息存入数据库和按需从数据库提取数据并存入缓存

#### 3.3 定时计算服务

负责定时计算指标约束并保存告警信息。

提供定时任务的开启，可更改的开始时间，任务时间间隔，任务启动与暂停，从缓存中提取指标约束和指标数据，根据约束进行计算。

#### 3.4 计算指标约束的检验，修改，新增服务

负责定时任务和实时任务计算时对指标约束的各种操作

提供在数据表中使用type属性区别定时任务和实时任务，从表中取出后存入Redis缓存中提高检索效率，根据约束规则对指标数据进行检验，违反约束的使用告警信息存储服务。

还可通过前端页面对指标添加，修改和删除。

#### 3.5 实时计算

负责指标存入时 根据指标数值和约束对指标进行计算并发出告警信息。

提供调用计算指标约束检验服务，对指标存储服务获取的数据进行计算。

#### 3.6 聚合计算

负责指标约束检验中的聚合计算

提供静态方法类Aggregation 根据聚合计算的类型进行计算并返回结果。

## 4 前端vue设计

本次前端是基于[GitHub](https://github.com/PanJiaChen/vue-admin-template)的一个纯前端开源项目为基础重构完成。

具体包括创建新页面，修改组件先，重写路由设置，修改环境配置，添加API接口与后端交互，删除无用功能如用户登录，mock拦截。

在前端实现了页面显示告警信息，告警规则。提供对告警规则的新增，删除，修改功能。提供对定时任务开始时间，时间间隔修改功能。

 
