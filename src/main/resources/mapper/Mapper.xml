<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.course.mapper.Mapper">

    <insert id="SavePostLog" parameterType="com.course.pojo.Log">
        INSERT INTO postlog (metric, tagJson, timestamp, value)
        VALUES (#{metric}, #{tagJson}, #{timestamp}, #{value})
    </insert>
    <insert id="SaveWarningLog" parameterType="com.course.pojo.Log">
        INSERT INTO warninglog (metric, tagJson, timestamp, value,description,time)
        VALUES (#{metric}, #{tagJson}, #{timestamp}, #{value},#{description},#{time})
    </insert>
    <!--    <insert id="SavePostLog">insert into test(id) values (2)</insert>-->
    <select id="GetPostLog" resultType="com.course.pojo.Log">
        select * from postlog
                 where metric = #{metric} and tagJson like #{instanceId};
    </select>
    <select id="GetMetricConstraint" resultType="com.course.pojo.MetricConstraint">
        select * from MetricConstraint
                 where metric = #{metric};
    </select>
    <select id="GetWarningLogAll" resultType="com.course.pojo.Log">
        select * from warninglog;
    </select>
    <select id="GetStartTime" resultType="java.lang.Integer">
        <if test="result != null">
            select timestamp
            from postlog
            order by timestamp desc
            limit 1
        </if>
        <if test="result == null">
            select -1;
        </if>
    </select>
    <select id="GetMemorySum" resultType="com.course.pojo.Log">
        <if test="result != null">
            select SUM(value) value,timestamp ,tagJson
            from (
            select * from postlog
            order by timestamp desc
            ) as t
            where metric in
            <foreach collection="MemoryNameList" item="item" index="index" separator="," open="(" close=")">
                #{item}
            </foreach>
            group by timestamp,tagJson
            limit 1
        </if>
            <if test="result == null">
                select -1,0,""
            </if>
    </select>
</mapper>
